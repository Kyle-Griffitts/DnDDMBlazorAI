@page "/"  
@rendermode InteractiveServer  
@using Azure.AI.OpenAI  
@using Azure.Identity  
@using OpenAI.Chat  
@inject Microsoft.Extensions.Configuration.IConfiguration _config  
@inject DungeonMasterChatService DungeonMasterChat  

<h3>Azure OpenAI Chat</h3>  
<div class="mb-3 d-flex align-items-center" style="margin:auto;">  
    <input class="form-control me-2" @bind="userMessage" placeholder="Type your message..." @onkeydown="HandleEnter" />  
    <button class="btn btn-primary" @onclick="SendMessage">Send</button>  
</div>  
<div class="card p-3" style="margin:auto;">  
    @foreach (var message in DungeonMasterChat.GetChatLog())
    {  
        <div class="mb-2">  
            <strong>@message.Role:</strong> @message.Content  
        </div>  
    }  
</div>  

@code {  
    private string? userMessage;  

    private async Task SendMessage()  
    {  
        if (string.IsNullOrWhiteSpace(userMessage)) return;  

        await DungeonMasterChat.SendMessageAsync(userMessage);  
        userMessage = string.Empty;  
        StateHasChanged();  
    }  

    private async void HandleEnter(KeyboardEventArgs e)  
    {  
        if (e.Key == "Enter")  
        {  
            await SendMessage();  
        }  
    }  
}